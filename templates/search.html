<html>

<head>
    <meta name='viewport' content="width=device-width,initial-scale=1.0" />
    <title>{{query}}-Searchpy</title>
    <meta name='description' content="A meta search engine,features of google,bing,youtube in 1 web app" />
    <link rel='shortcut icon' href='/favicon.ico' />
    <style>
        a:active {
            color: #1a0dab;
        }

        .input_n {
            border: none;
            border: 1px solid #6200ee;
            border-radius: 20px;
            outline: none;
            width: 50%;
            height: 30px;
            padding: 8px;
        }

        .submit-button {
            text-transform: uppercase;
            width: 50px;
            border-radius: 15px;
            padding: 8px;
            border: none;
            outline: none;
            background: #3367d6;
            color: white;
            cursor: pointer;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .res_title,
        .res_content {
            word-break: break-all;
        }

        .link_cite {
            color: #00651f
        }

        #google,
        #bing {
            margin-left: 70px;
        }

        .title_ {
            margin-bottom: 5px;
        }

        .result-snipps {
            font-weight: lighter;
        }

        .cached {
            cursor: pointer;
        }

        .search-result {
            max-width: 65%;
            box-shadow: #d9dce0 2px 2px 2px 2px;
            border-radius: 15px;
            padding: 8px;
            margin-bottom: 5px;
            word-break: break-all;
        }

        @media only screen and (max-width: 600px) {
            .search-result {
                max-width: 100%;
            }
        }

        .load-more {
            text-align: center;
            border-radius: 15px;
            border: 2px solid #e3e3f3;
            height: 25px;
            color: #000;
        }

        .skelly_misc {
            height: 100px;
            background-color: #e3e3e3;
            width: 400px;
            MARGIN-TOP: 10px;
            margin-left: 35px;
            border-radius: 15px;
        }

        .other_searches {
            background-color: #f2f2f2;
            border: 1px solid #f2f2f2;
            border-radius: 20px;
            color: #757575;
            cursor: default;
            font-family: arial, sans-serif;
            font-size: 13px;
            font-weight: bold;
            display: inline-flex;
            margin: 1;
            width: auto;
            padding: 0 16px;
            text-align: center;
            text-decoration: none;
            min-height: 20px;
            align-items: center;
        }

        .other_searches a {
            text-decoration: none;
            color: #757575;
        }
    </style>
</head>

<body>
    <form action='/search'>
        <div>
            <input type="text" class="input_n" id='search_button' name='q'>
            <button class=submit-button>Go</button>
        </div>
    </form>
    <div class=images-youtube=bar>
        <span class=other_searches>
            <a href='/images/search?q={{query|safe}}'>Images</a>
        </span>
        <span class=other_searches>
            <a href="/youtube/search?q={{query|safe}}">Youtube</a>
        </span>
    </div>
    <div id=skelly>
        <div class="skelly_misc"></div>
        <div class="skelly_misc"></div>
        <div class="skelly_misc"></div>
        <div class="skelly_misc"></div>
    </div>
    <div class=content id=main style="display: none;">
        <h1>Results from Google</h1>
        <div id=google></div>
        <a id=load-more-goog data-start='{{start+10}}' href="/search?q={{query}}&start={{start+10}}">
            <div class=load-more>Load More Results From Google</div>
        </a>
        <h1>Results from Bing</h1>
        <div id=bing></div>
        <a id=load-more-bing data-start='{{start+10}}' href="/search?q={{query}}&start={{start+10}}">
            <div class=load-more>Load More Results From Bing</div>
        </a>
    </div>
    <script>
        function make_results(data_dict, container) {
            if (data_dict.length == 0) {
                container.innerHTML += '<div>No Links Found</div>';
            }
            for (dat in data_dict) {
                var div = document.createElement("div");
                var link = document.createElement("a");
                var cache_link = document.createElement("a");
                var link_text = document.createElement('span');
                var title = document.createElement("h3");
                var deets = document.createElement("div");
                var cached_box = document.createElement("span");
                var data = data_dict[dat];
                var cached = data.cached;
                link_text.className = "link_cite";
                div.className = 'search-result'
                link.href = "/url?url=" + encodeURIComponent(data.link);
                title.innerHTML = data.heading;
                title.className = 'title_'
                deets.innerHTML = data.text;
                deets.className = 'result-snipps'
                cached_box.innerHTML = "View Cached";
                cached_box.className = 'cached';
                link_text.innerHTML = data.link;
                link.appendChild(title);
                link.appendChild(link_text);
                div.appendChild(link);
                div.appendChild(deets);
                container.appendChild(div);
                if (cached) {
                    cache_link.href = "/url?url=" + encodeURIComponent(cached);;
                    cache_link.appendChild(cached_box);
                    div.appendChild(cache_link);
                }
            }
        }
        (function (q) {
            req = new Request('/search/get_results/?start={{start}}&q=' + encodeURIComponent(q));
            document.getElementById("search_button").value = q;
            fetch(req).then(resp =>
                resp.json()).then(ret => {
                google = ret.google;
                bing = ret.bing;
                google_data = google.data;
                bing_data = bing.data;
                document.getElementById("main").style.display = 'block';
                document.getElementById('skelly').style.display = 'none';
                make_results(google_data, document.getElementById("google"));
                make_results(bing_data, document.getElementById("bing"));
            }).catch(e => {
                if (window.location.protocol == 'file:') {
                    return
                }
                console.error(e);
                document.body.innerHTML = "Snap...something broke on our end..apologies";

            })
        })("{{query|safe}}");
        var load_more_goog = document.getElementById("load-more-goog");
        var load_more_bing = document.getElementById("load-more-bing");
        (function (a, b, c, d) {
            function spec_search(name, start) {
                fetch('/search/get/' + name + "?start=" + start + "&q={{query|safe}}")
                    .then(res => res.json())
                    .then(ret => {
                        make_results(ret[name].data, document.getElementById(name))
                    }).catch(e => {
                        document.getElementById(name).innerHTML += "<div>Can't find more links</div>"
                    })
            }
            a.addEventListener("click", function (e) {
                e.preventDefault();
                a.setAttribute("data-start", parseInt(a.getAttribute("data-start")) + 10)
                start = a.getAttribute("data-start")
                spec_search(c, start)
            });
            b.addEventListener("click", function (e) {
                e.preventDefault();
                b.setAttribute("data-start", parseInt(b.getAttribute("data-start")) + 10);
                start = a.getAttribute("data-start")
                spec_search(d, start)
            });

        })(load_more_goog, load_more_bing, 'google', 'bing')
    </script>
</body>